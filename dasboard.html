<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IOI Library | Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav id="nav" class="navbar navbar-dark px-4 shadow-sm">
        <span class="navbar-brand fw-bold">IOI LIBRARY</span>
        <div class="text-white small">
            <span id="uName"></span> | <a href="index.html" class="text-white text-decoration-none" onclick="sessionStorage.clear()">Logout</a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <aside class="col-md-3 col-lg-2 sidebar p-4">
                <h6 class="fw-bold text-muted small mb-3">MY LIBRARY</h6>
                <div id="libBox" class="list-group list-group-flush small"></div>
            </aside>
            <main class="col-md-9 col-lg-10 p-4">
                <h2 id="deptTitle" class="mb-4"></h2>
                <div id="grid" class="row g-4"></div>
            </main>
        </div>
    </div>

    <div class="modal fade" id="pdfMod" tabindex="-1"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 id="mHead"></h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body text-center py-5 bg-light"><i class="bi bi-file-earmark-pdf-fill display-1 text-danger"></i><p class="mt-3">Document Viewer Ready</p></div></div></div></div>

    <script>
    // If this returns null, the login didn't save the data correctly
const user = JSON.parse(sessionStorage.getItem('activeUser')); 

// If data is missing, it should kick the user back to login
if (!user) window.location.href = "index.html";

        const content = {
            SOT: ["C Programming", "Computer Organization", "Mathematics for CS", "OJT", "English Communication"],
            SOH: ["Anatomy", "Physiology", "Healthcare Management", "OJT", "English Communication"]
        };

        document.getElementById('nav').classList.add(user.dept === 'SOT' ? 'navbar-sot' : 'navbar-soh');
        document.getElementById('uName').innerText = `${user.name} (${user.enroll})`;
        document.getElementById('deptTitle').innerText = user.dept === 'SOT' ? "School of Technology" : "School of Healthcare";

        function showSubjects() {
            const grid = document.getElementById('grid');
            grid.innerHTML = content[user.dept].map(s => `
                <div class="col-md-4"><div class="card p-4 subject-card text-center" onclick="showPPTs('${s}')"><h5>${s}</h5></div></div>
            `).join('');
        }

        function showPPTs(s) {
            const grid = document.getElementById('grid');
            grid.innerHTML = `<div class="col-12"><button class="btn btn-sm btn-secondary mb-3" onclick="showSubjects()">Back</button><h4>${s} Files</h4></div>`;
            for(let i=1; i<=3; i++) {
                const t = `${s} - Day ${i}`;
                grid.innerHTML += `
                    <div class="col-12"><div class="ppt-row d-flex justify-content-between align-items-center">
                        <span>${t}</span>
                        <div><button class="btn btn-sm btn-outline-primary" onclick="read('${t}')">Read</button>
                        <button class="btn btn-sm btn-primary" onclick="add('${t}')">Add to Library</button></div>
                    </div></div>`;
            }
        }

        let lib = JSON.parse(localStorage.getItem(`lib_${user.email}`)) || [];
        function add(t) { if(!lib.includes(t)) { lib.push(t); localStorage.setItem(`lib_${user.email}`, JSON.stringify(lib)); updateUI(); } }
        function updateUI() { document.getElementById('libBox').innerHTML = lib.map(i => `<div class="list-group-item d-flex justify-content-between small border-0 border-bottom px-0">${i} <i class="bi bi-x-circle text-danger" onclick="rem('${i}')"></i></div>`).join(''); }
        function rem(i) { lib = lib.filter(x => x !== i); localStorage.setItem(`lib_${user.email}`, JSON.stringify(lib)); updateUI(); }
        function read(t) { document.getElementById('mHead').innerText = t; new bootstrap.Modal(document.getElementById('pdfMod')).show(); }

        window.onload = () => { showSubjects(); updateUI(); };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
