<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IOI Library | Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root { --sot: #0d6efd; --soh: #198754; }
        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
        .nav-sot { background: var(--sot) !important; }
        .nav-soh { background: var(--soh) !important; }
        .subject-card { cursor: pointer; transition: 0.3s; border: none; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .subject-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
        .sidebar { background: white; min-height: 100vh; border-right: 1px solid #eee; }
        .ppt-row { background: white; border-radius: 8px; padding: 15px; margin-bottom: 10px; border: 1px solid #e5e7eb; }
        iframe { width: 100%; height: 500px; border-radius: 8px; }
    </style>
</head>
<body>

<nav id="nav" class="navbar navbar-dark px-4 shadow-sm">
    <span class="navbar-brand fw-bold">IOI LIBRARY</span>
    <div class="text-white small">
        <span id="uName"></span> | <a href="index.html" class="text-white text-decoration-none" onclick="sessionStorage.clear()">Logout</a>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <aside class="col-md-3 col-lg-2 sidebar p-4">
            <h6 class="fw-bold text-muted small mb-3"><i class="bi bi-bookmark-star"></i> MY LIBRARY</h6>
            <div id="libBox" class="list-group list-group-flush small"></div>
        </aside>

        <main class="col-md-9 col-lg-10 p-4">
            <h2 id="deptTitle" class="mb-4 text-dark"></h2>
            <div id="grid" class="row g-4"></div>
        </main>
    </div>
</div>

<div class="modal fade" id="pdfMod" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="mHead">Reading Mode</h5>
                <button class="btn-close" data-bs-dismiss="modal" onclick="closeViewer()"></button>
            </div>
            <div class="modal-body p-0">
                <iframe id="pdfFrame" src="" allow="autoplay"></iframe>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. Session & Data Setup
    const user = JSON.parse(sessionStorage.getItem('activeUser'));
    if (!user) window.location.href = "index.html";

    // This object contains your specific Google Drive links
    const pptsData = {
        "OJT": [
            { 
                title: "OJT Day 1: Getting Started with Web Development", 
                url: "https://drive.google.com/file/d/1oA7In2zqEgh-hPEFeve1MjbcGfBh5ek3/preview" 
            },
            { 
                title: "OJT Day 2: Web Architecture & Roles", 
                url: "https://drive.google.com/file/d/1BNFOSmqX6UEUTyRd3vQtG4dqlfok6rDB/preview" 
            }
        ],
        "C Programming": [{ title: "Day 1: Intro to C", url: "#" }],
        "Computer Organization": [{ title: "Day 1: COA Basics", url: "#" }],
        "Mathematics for CS": [{ title: "Day 1: Discrete Math", url: "#" }],
        "English Communication": [{ title: "Day 1: Business English", url: "#" }]
    };

    const deptSubjects = {
        SOT: ["C Programming", "Computer Organization", "Mathematics for CS", "OJT", "English Communication"],
        SOH: ["Anatomy", "Physiology", "Healthcare Management", "OJT", "English Communication"]
    };

    // 2. UI Init
    document.getElementById('nav').classList.add(user.dept === 'SOT' ? 'nav-sot' : 'nav-soh');
    document.getElementById('uName').innerText = `${user.name} (${user.enroll})`;
    document.getElementById('deptTitle').innerText = user.dept === 'SOT' ? "School of Technology" : "School of Healthcare";

    function showSubjects() {
        const grid = document.getElementById('grid');
        grid.innerHTML = deptSubjects[user.dept].map(s => `
            <div class="col-md-4">
                <div class="card p-4 subject-card text-center" onclick="showPPTs('${s}')">
                    <i class="bi bi-folder2-open display-6 mb-2 text-primary"></i>
                    <h5 class="m-0">${s}</h5>
                </div>
            </div>
        `).join('');
    }

    function showPPTs(s) {
        const grid = document.getElementById('grid');
        grid.innerHTML = `<div class="col-12"><button class="btn btn-sm btn-secondary mb-3" onclick="showSubjects()">‚Üê Back to Subjects</button><h4>${s} Resources</h4></div>`;
        
        // Load data from our pptsData object, or show default if not added yet
        const list = pptsData[s] || [{title: `${s} - Day 1`, url: "#"}];
        
        grid.innerHTML += list.map(ppt => `
            <div class="col-12">
                <div class="ppt-row d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-file-earmark-pdf text-danger me-2"></i> ${ppt.title}</span>
                    <div>
                        <button class="btn btn-sm btn-outline-primary me-2" onclick="read('${ppt.title}', '${ppt.url}')">Read It</button>
                        <button class="btn btn-sm btn-primary" onclick="add('${ppt.title}')">Add to Library</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // 3. Library & Reader Logic
    let lib = JSON.parse(localStorage.getItem(`lib_${user.email}`)) || [];
    
    function add(t) { 
        if(!lib.includes(t)) { 
            lib.push(t); 
            localStorage.setItem(`lib_${user.email}`, JSON.stringify(lib)); 
            updateUI(); 
        } 
    }
    
    function updateUI() { 
        document.getElementById('libBox').innerHTML = lib.map(i => `
            <div class="list-group-item d-flex justify-content-between small border-0 border-bottom px-0">
                ${i} <i class="bi bi-x-circle text-danger cursor-pointer" onclick="rem('${i}')"></i>
            </div>`).join(''); 
    }
    
    function rem(i) { 
        lib = lib.filter(x => x !== i); 
        localStorage.setItem(`lib_${user.email}`, JSON.stringify(lib)); 
        updateUI(); 
    }

    function read(title, url) {
        if(url === "#") { alert("File not uploaded yet!"); return; }
        document.getElementById('mHead').innerText = title;
        document.getElementById('pdfFrame').src = url;
        new bootstrap.Modal(document.getElementById('pdfMod')).show();
    }

    function closeViewer() {
        document.getElementById('pdfFrame').src = ""; // Stops the PDF from loading in background
    }

    window.onload = () => { showSubjects(); updateUI(); };
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
